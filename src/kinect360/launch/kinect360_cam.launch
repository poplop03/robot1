<launch>
  <!-- Create the nodelet manager -->
  <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager" />

  <!-- OpenNI Camera Driver as nodelet (RGB + Depth) -->
  <node pkg="nodelet" type="nodelet" name="openni_driver" args="load openni_camera/OpenNINodelet nodelet_manager" output="screen">
    <param name="depth_registration" value="true" />
  </node>

  <!-- Image pipeline nodelet: RGB rectification -->
  <node pkg="nodelet" type="nodelet" name="rectify_color" args="load image_proc/image_proc nodelet_manager" output="screen">
    <!-- Fixed remap: image_raw -> image_color -->
    <remap from="image_raw" to="/camera/rgb/image_color"/>
    <remap from="camera_info" to="/camera/rgb/camera_info"/>
    <remap from="image" to="/camera/rgb/image_rect_color"/>
  </node>

  <!-- RGBD sync nodelet (all in shared memory via nodelet_manager) -->
  <node pkg="nodelet" type="nodelet" name="rgbd_sync" args="load rtabmap_sync/rgbd_sync nodelet_manager" output="screen">
    <remap from="rgb/image"       to="/camera/rgb/image_rect_color"/>
    <remap from="depth/image"     to="/camera/depth_registered/image_raw"/>
    <remap from="rgb/camera_info" to="/camera/rgb/camera_info"/>
    <remap from="rgbd_image"      to="/rgbd_image"/>
    <param name="approx_sync" value="true"/>
    <param name="approx_sync_max_interval" type="double" value="0.015"/>
    <param name="queue_size" type="int" value="10"/>
  </node>
</launch>
